<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project 1</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <h3>Team Members</h3>
    <p>Ayslin Walker, Imani Thompson, Fedinard Nyanyo</p>

    <p id="sea-levels">
      <svg id="sea-levels" width="1200" height="800"></svg>

      <script>
        d3.csv("data/Change_in_Mean_Sea_Levels.csv").then(function (data) {
          const svg = d3.select("svg#sea-levels");
          const width = svg.attr("width");
          const height = svg.attr("height");
          const margins = { top: 40, right: 20, bottom: 50, left: 150 };
          const chartWidth = width - margins.left - margins.right;
          const chartHeight = height - margins.top - margins.bottom;

          let chartArea = svg
            .append("g")
            .attr("transform", `translate(${margins.left},${margins.top})`);

          let seaData = {};
          let worldAverage;
          data.forEach((d) => {
            if (!seaData[d.Measure]) {
              seaData[d.Measure] = {
                sum: 0,
                count: 0,
              };
            }
            let value = parseFloat(d.Value);
            seaData[d.Measure].sum += value;
            seaData[d.Measure].count++;
          });
          worldAverage = seaData["World"].sum / seaData["World"].count;

          let meanChangeBySea = Object.entries(seaData)
            .map(([sea, data]) => ({
              sea: sea,
              meanChange: data.sum / data.count,
            }))
            .filter((d) => d.sea !== "World")
            .sort((a, b) => a.meanChange - b.meanChange);

          const xScale = d3
            .scaleLinear()
            .domain([0, d3.max(meanChangeBySea, (d) => d.meanChange)])
            .range([0, chartWidth]);

          const yScale = d3
            .scaleBand()
            .domain(meanChangeBySea.map((d) => d.sea))
            .range([0, chartHeight])
            .padding(0.3);

          meanChangeBySea.forEach((d) => {
            chartArea
              .append("rect")
              .attr("class", "bar")
              .attr("x", xScale(0))
              .attr("y", yScale(d.sea))
              .attr("width", xScale(d.meanChange) - xScale(0))
              .attr("height", yScale.bandwidth())
              .attr("fill", "#FFA500");

            chartArea
              .append("text")
              .attr("x", xScale(0) - 5)
              .attr("y", yScale(d.sea) + yScale.bandwidth() / 2)
              .attr("dy", ".35em")
              .attr("text-anchor", "end")
              .text(d.sea);
          });

          chartArea
            .append("line")
            .attr("x1", xScale(worldAverage))
            .attr("y1", 0)
            .attr("x2", xScale(worldAverage))
            .attr("y2", chartHeight)
            .attr("stroke", "black")
            .attr("stroke-width", 2);

          chartArea
            .append("text")
            .attr("x", xScale(worldAverage))
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .text(`World Average(${worldAverage.toFixed(2)} mm)`);

          chartArea
            .append("g")
            .attr("transform", `translate(0,${chartHeight})`)
            .call(d3.axisBottom(xScale).ticks(10));

          svg
            .append("text")
            .attr("x", width / 2)
            .attr("y", 20)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .text("Trend in Mean Sea Levels");

          svg
            .append("text")
            .attr("transform", `translate(${width / 2},${height - 10})`)
            .style("text-anchor", "middle")
            .text("Mean yearly change in sea level (mm)");
        });
      </script>
    </p>
  </body>
</html>
